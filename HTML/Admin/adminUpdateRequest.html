<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Update Request</title>
</head>

<body>
    <h1>Admin Update Requests</h1>
    <p>Please enter the Request ID of the request that you</p>
    <p>would like to approve or deny.</p>
    Request ID: <input type = "text" id = "requestId"> <br>
    <form action = "/action_page.php">
        <label for = "status"> Choose a status: </label>
          <select name = "status" id = "status">
            <option value = "pending"> Approved </option>
            <option value = "denied"> Denied </option>
          </select>
          <br>
      </form>    
    <button type = "button" onclick = "getUpdateParameters(); updateRequestStatus()"> Submit updated status</button> <br>
    <button type = "button" onclick = "adminMenu()"> Back to Admin Menu </button>
</body>

<script>
    async function getUpdateParameters() {
        let requestId = document.getElementById("requestId").value;

        //send to server
        let url = 'http://localhost:8080/P1/task?task-id=' + requestId;
        let response = await fetch( url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json;charset-utf-8'
            }
        });

        //parse the json in the response
        let task = await response.json();

        window.localStorage.setItem('task', task)

        let htmlElement = document.getElementById("request");

        //duplicate paramaters to send back in update
    }

    async function updateRequestStatus() {
        let requestId = document.getElementById("requestId").value;
        let status = document.getElementById("status").value;
        let task = window.localStorage.getItem("task");     //retrieve task json from local storage

        let request = {
            title: task.title.value,
            message: task.message.value,
            userId: task.userId.value,
            taskId: task.taskId.value,
            amount: task.amount.value,
            reimbursed: status.value,
        }



        //send to server
        let url = 'http://localhost:8080/P1/task?task-id=' + requestId;
        let response = await fetch( url, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json;charset-utf-8'
            },
            body: JSON.stringify(request)
        });

        if (response.status == 200) {
            alert("success! Request status has been changed!")
        } else {
            alert("Something went wrong!")
        }

    }



    async function adminMenu() {
        location.href = 'file:///C:/Users/bobby/Desktop/Revature/Java/P1/HTML/Admin/adminCommands.html';
    }
</script>